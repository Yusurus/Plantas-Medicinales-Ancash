<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registrar Planta</title>
  <link rel="icon" type="image/ico" href="/static/img/faviconuwu.ico">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Archivo CSS propio -->
  <link href="../static/css/stylesNavbar.css" rel="stylesheet" />
  <link href="../static/css/stylesRegistros.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
  {% include 'navbar.html' %}

  <div class="container my-5">
    <h2 class="mb-4 text-center">Gestión de Plantas</h2>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="plantaTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="registro-tab" data-bs-toggle="tab" data-bs-target="#registro" type="button" role="tab" aria-controls="registro" aria-selected="true">
          <i class="bi bi-plus-circle"></i> Registrar Planta
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="zonas-tab" data-bs-toggle="tab" data-bs-target="#zonas" type="button" role="tab" aria-controls="zonas" aria-selected="false">
          <i class="bi bi-geo-alt"></i> Agregar Zona
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="saberes-tab" data-bs-toggle="tab" data-bs-target="#saberes" type="button" role="tab" aria-controls="saberes" aria-selected="false">
          <i class="bi bi-book"></i> Saberes Culturales
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="medicinales-tab" data-bs-toggle="tab" data-bs-target="#medicinales" type="button" role="tab" aria-controls="medicinales" aria-selected="false">
          <i class="bi bi-heart-pulse"></i> Usos Medicinales
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="archivacion-tab" data-bs-toggle="tab" data-bs-target="#archivaciones" type="button" role="tab" aria-controls="archivaciones" aria-selected="false">
          <i class="bi bi-box-arrow-down"></i> Archivaciones
        </button>
      </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content mt-4" id="plantaTabContent">
      
      <!-- Pestaña 1: Registro planta-->
      <div class="tab-pane fade show active" id="registro" role="tabpanel" aria-labelledby="registro-tab">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Registrar Nueva Planta</h5>
            
            <form id="plantaForm" enctype="multipart/form-data" method="POST" class="needs-validation" novalidate>

              <div class="mb-3">
                <label for="nombreCientifico" class="form-label">Nombre Científico:</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="nombreCientifico" name="nombreCientifico" required />
                  <button class="btn btn-outline-secondary" type="button" id="buscarPlantnetBtn" title="Buscar en PlantNet">
                    <i class="bi bi-search"></i>
                  </button>
                  <div class="invalid-feedback">
                    Por favor, ingrese el nombre científico.
                  </div>
                </div>
              </div>

              <div id="loadingPlantnet" class="hidden text-center mt-3 text-success d-none">
                <div class="spinner-border text-success" role="status">
                  <span class="visually-hidden">Cargando...</span>
                </div>
                Buscando en PlantNet...
              </div>
              <div id="errorPlantnet" class="hidden alert alert-danger mt-3 d-none" role="alert"></div>

              <div class="mb-3">
                <label for="nomFamilia" class="form-label">Familia:</label>
                <select class="form-select" id="nomFamilia" name="nomFamilia" required>
                  <option value="" disabled selected>Seleccione una familia</option>
                  {% for familia in familias %}
                  <option value="{{ familia }}">{{ familia }}</option>
                  {% endfor %}
                </select>
                <div class="invalid-feedback">
                  Seleccione una familia válida.
                </div>
              </div>

              <div class="mb-3">
                <label for="imagen" class="form-label">Imagen (URL)</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="imagen" placeholder="Ingrese URL de imagen" />
                  <button class="btn btn-outline-primary" type="button" onclick="agregarImagen()">Añadir</button>
                </div>
                <div class="invalid-feedback">
                  Debe subir una imagen en formato JPG, PNG, etc.
                </div>
                <input type="hidden" id="imagenesInput" name="imagenes" />
                <!-- Contenedor de las miniaturas -->
                <div id="contenedorImagenes" class="d-flex flex-wrap gap-2 mt-3"></div>
              </div>

              <div class="mb-3">
                <label for="nombreComunInput" class="form-label">Nombre Común:</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="nombreComunInput" placeholder="Ingrese un nombre común" />
                  <button class="btn btn-outline-primary" type="button" onclick="agregarNombreComun()">Añadir</button>
                </div>
              </div>

              <div class="mb-3">
                <strong>Nombres Comunes:</strong>
                <ul id="listaNombresComunes" class="list-group mt-2"></ul>
              </div>

              <!-- Campo oculto para enviar los nombres comunes -->
              <input type="hidden" id="nombresComunesInput" name="nombresComunes" />

              <div class="d-grid">
                <button type="submit" class="btn btn-success btn-lg">Registrar</button>
              </div>
            </form>

            <p id="mensaje" class="mt-3 text-center text-success">{{ mensaje if mensaje }}</p>
          </div>
        </div>
      </div>

      <!-- Pestaña 2: Agregar Zona -->
      <div class="tab-pane fade" id="zonas" role="tabpanel" aria-labelledby="zonas-tab">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Agregar Zona a Planta Existente</h5>
            
          </div>
        </div>
      </div>

      <!-- Pestaña 3: Saberes Culturales -->
      <div class="tab-pane fade" id="saberes" role="tabpanel" aria-labelledby="saberes-tab">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Saberes Culturales y Tradicionales</h5>
            
          </div>
        </div>
      </div>

      <!-- Pestaña 4: Usos Medicinales -->
      <div class="tab-pane fade" id="medicinales" role="tabpanel" aria-labelledby="medicinales-tab">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Usos Medicinales</h5>
            
          </div>
        </div>
      </div>

      <!-- Pestaña 5: Archivaciones -->
      <div class="tab-pane fade" id="archivaciones" role="tabpanel" aria-labelledby="archivacion-tab">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Archivaciones</h5>
            
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../static/js/regsitroPlanta.js"></script>
  
  <script>
    // Función para cargar plantas existentes
    function cargarPlantasExistentes() {
      // Esta función debería hacer una petición AJAX para obtener las plantas
      // y poblar los selects de las otras pestañas
      console.log("Cargando plantas existentes...");
    }

    // Cargar plantas al inicializar
    document.addEventListener('DOMContentLoaded', cargarPlantasExistentes);
  </script>
</body>

</html>